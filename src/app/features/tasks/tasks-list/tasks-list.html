<div class="container">
    <div class="header-actions">
        <h1>××©×™××•×ª ×¤×¨×•×™×§×˜ #{{ projectId() }}</h1>
        <button class="btn-primary" (click)="openCreateTaskModal()">+ ××©×™××” ×—×“×©×”</button>
    </div>

    @if (showAddTask()) {
        <app-new-tasks [projectId]="projectId()" (close)="showAddTask.set(false)"></app-new-tasks>
    }

    @if (showEditTask()) {
       <app-update-task [task]="selectedTask()" (closeModal)="showEditTask.set(false)"></app-update-task>
    }

    @if (isLoading()) {
        <div class="loading-container">
            <div class="spinner"></div>
            <p>×˜×•×¢×Ÿ ××©×™××•×ª...</p>
        </div>
    } @else {
        <div class="tasks-grid">
            @if (tasks$ | async; as tasks) {
                @for (task of tasks; track task.id) {
                    <div class="task-card">
                        <div class="task-priority" [ngClass]="task.priority">
                            {{ task.priority }}
                        </div>

                        <div class="card-content">
                            <h3>{{ task.title }}</h3>
                            <p>{{ task.description }}</p>
                            <div class="task-meta">
                                <span>×¡×˜×˜×•×¡: <strong>{{ task.status }}</strong></span>
                                <span>××©×•×™×š ×œ××©×ª××©: {{ task.assignee_id }}</span>
                            </div>
                        </div>

                        <div class="comments-wrapper">
                            <hr />
                            <app-comment-section [taskId]="task.id"></app-comment-section>
                        </div>

                        <div class="card-actions">
                            <button (click)="openEditTaskModal(task)" class="btn-edit">×¢×¨×•×š âœï¸</button>
                            <button (click)="deleteTask(task.id)" class="btn-delete">××—×§ ğŸ—‘ï¸</button>
                        </div>
                    </div>
                } @empty {
                    <div class="empty-state">
                        <p>××™×Ÿ ××©×™××•×ª ×‘×¤×¨×•×™×§×˜ ×–×”. ×”×’×™×¢ ×”×–××Ÿ ×œ×ª×›× ×Ÿ!</p>
                    </div>
                }
            }
        </div>
    }
</div>